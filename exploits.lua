-- our menu elements :D
local exploit_choice = ui.new_combobox("AA", "Anti-aimbot angles", "Exploit choice", {"Default", "Roll aa", "Fake flick"})
local fake_flick = ui.new_hotkey("AA", "Anti-aimbot angles", "Fake Flick (use only with default aa preset)")
local fake_flick_invert = ui.new_hotkey("AA", "Anti-aimbot angles", "Inverter")

-- all aa refs
local yawbody, yaw = ui.reference("AA", "Anti-aimbot angles", "Yaw")
local bodyyaw, bodyyaw2 = ui.reference("AA", "Anti-aimbot angles", "Body yaw")
local freeyaw = ui.reference("AA", "Anti-aimbot angles", "Freestanding body yaw")
local edge = ui.reference("AA", "Anti-aimbot angles", "Edge yaw")
local jyaw, jyawslide = ui.reference("AA", "Anti-aimbot angles", "Yaw jitter")
local pitch = ui.reference("AA", "Anti-aimbot angles", "Pitch")
local yawbase = ui.reference("AA", "Anti-aimbot angles", "Yaw base")
local freestanding, freestanding2 = ui.reference("AA", "Anti-aimbot angles", "Freestanding")
local fyawlimit = ui.reference("AA", "Anti-aimbot angles", "Fake yaw limit")
local freestand_byaw = ui.reference("AA", "Anti-aimbot angles", "Freestanding body yaw")
local slow_walk, slow_walk2 = ui.reference("AA", "Other", "Slow motion")
local fl_limit = ui.reference("AA","Fake lag","Limit")
local yaw, yaw_val = ui.reference("AA","Anti-aimbot angles","Yaw")
local byaw, byaw_val = ui.reference("AA","Anti-aimbot angles","Body yaw")

-- this is here for debugging or indicators whatever you want idgaf
local state = "NONE"

---rollllll
-- local variables for API functions. any changes to the line below will be lost on re-generation
local bit_band, client_set_event_callback, entity_get_local_player, entity_get_prop, entity_is_alive, math_sqrt, renderer_indicator, ui_get, ui_new_checkbox, ui_new_combobox, ui_new_slider, ui_reference, GetState, ui_set, ui_set_visible = bit.band, client.set_event_callback, entity.get_local_player, entity.get_prop, entity.is_alive, math.sqrt, renderer.indicator, ui.get, ui.new_checkbox, ui.new_combobox, ui.new_slider, ui.reference, GetState, ui.set, ui.set_visible

local AA_roll = ui_reference("AA", "Anti-Aimbot Angles", "Roll")
local AA_SlowWalk, AA_SlowWalk_Key = ui_reference("AA", "other", "Slow Motion")
local RAGE_FakeDuck = ui_reference('Rage', 'Other', 'Duck peek assist')



local sex = ui_new_checkbox("AA", "Anti-Aimbot Angles", "Enable Roll aa")
local state_select = ui_new_combobox("AA", "Anti-Aimbot Angles", "Movement State Selector", "Running", "Standing", "Crouching", "Slow-Walking", "In-Air")
local Roll_Running = ui_new_slider("AA", "Anti-Aimbot Angles", "Running Roll Angle", -50, 50, 0, true, "°", 1)
local Roll_Standing = ui_new_slider("AA", "Anti-Aimbot Angles", "Standing Roll Angle", -50, 50, 0, true, "°", 1)
local Roll_Crouching = ui_new_slider("AA", "Anti-Aimbot Angles", "Crouching Roll Angle", -50, 50, 0, true, "°", 1)
local Roll_Slowwalk = ui_new_slider("AA", "Anti-Aimbot Angles", "Slowwalk Roll Angle", -50, 50, 0, true, "°", 1)
local Roll_InAir = ui_new_slider("AA", "Anti-Aimbot Angles", "In-Air Roll Angle", -50, 50, 0, true, "°", 1)


local function state_player()
    if entity.get_local_player() == nil then return end

    local vx, vy = entity.get_prop(entity.get_local_player(), 'm_vecVelocity')
    local player_standing = math.sqrt(vx ^ 2 + vy ^ 2) < 2
	local player_jumping = bit.band(entity.get_prop(entity.get_local_player(), 'm_fFlags'), 1) == 0
    local player_crouching = entity.get_prop(entity.get_local_player(), "m_flDuckAmount") > 0.5 and not player_duck_peek_assist
    local player_slow_motion = ui.get(AA_SlowWalk_Key)

    if player_slow_motion then
        return 'slowmotion'
    elseif player_crouching then
        return 'crouch'
    elseif player_jumping then
        return 'jump'
    elseif player_standing then
        return 'stand'
    elseif not player_standing then
        return 'move'
    end
end


client_set_event_callback("run_command", function()
    if entity.get_local_player() == nil then return end
    if ui.get(sex) and state_player() == 'stand' then
        ui.set(AA_roll, ui.get(Roll_Standing))
    end
    if ui.get(sex) and state_player() == 'move' then
        ui.set(AA_roll, ui.get(Roll_Running))
    end
    if ui.get(sex) and state_player() == 'crouch' then
        ui.set(AA_roll, ui.get(Roll_Crouching))
    end
    if ui.get(sex) and state_player() == 'slowmotion' then
        ui.set(AA_roll, ui.get(Roll_Slowwalk))
    end
    if ui.get(sex) and state_player() == 'jump' then
        ui.set(AA_roll, ui.get(Roll_InAir))
    end 
end)

--VISIBILTY -----------------------------------
ui_set_visible(Roll_Running, false)
ui_set_visible(Roll_Standing, false)
ui_set_visible(Roll_Crouching, false)
ui_set_visible(Roll_Slowwalk, false)
ui_set_visible(Roll_InAir, false)

client_set_event_callback("paint", function()
    if not ui.get(sex) then
        ui.set_visible(state_select, false)
        ui_set_visible(Roll_Running, false)
        ui_set_visible(Roll_Standing, false)
        ui_set_visible(Roll_Crouching, false)
        ui_set_visible(Roll_Slowwalk, false)
        ui_set_visible(Roll_InAir, false)
        ui.set_visible(AA_roll, true)
    else
        ui.set_visible(AA_roll, false)
        ui.set_visible(state_select, true)
        if ui_get(state_select) == "Running" then
            ui_set_visible(Roll_Running, true)
            ui_set_visible(Roll_Standing, false)
            ui_set_visible(Roll_Crouching, false)
            ui_set_visible(Roll_Slowwalk, false)
            ui_set_visible(Roll_InAir, false)
        elseif ui_get(state_select) == "Standing" then
            ui_set_visible(Roll_Running, false)
            ui_set_visible(Roll_Standing, true)
            ui_set_visible(Roll_Crouching, false)
            ui_set_visible(Roll_Slowwalk, false)
            ui_set_visible(Roll_InAir, false)
        elseif ui_get(state_select) == "Crouching" then
            ui_set_visible(Roll_Running, false)
            ui_set_visible(Roll_Standing, false)
            ui_set_visible(Roll_Crouching, true)
            ui_set_visible(Roll_Slowwalk, false)
            ui_set_visible(Roll_InAir, false)
        elseif ui_get(state_select) == "Slow-Walking" then
            ui_set_visible(Roll_Running, false)
            ui_set_visible(Roll_Standing, false)
            ui_set_visible(Roll_Crouching, false)
            ui_set_visible(Roll_Slowwalk, true)
            ui_set_visible(Roll_InAir, false)
        elseif ui_get(state_select) == "In-Air" then
            ui_set_visible(Roll_Running, false)
            ui_set_visible(Roll_Standing, false)
            ui_set_visible(Roll_Crouching, false)
            ui_set_visible(Roll_Slowwalk, false)
            ui_set_visible(Roll_InAir, true)
        elseif ui_get(state_select) == "Fake-ducking" then
            ui_set_visible(Roll_Running, false)
            ui_set_visible(Roll_Standing, false)
            ui_set_visible(Roll_Crouching, false)
            ui_set_visible(Roll_Slowwalk, false)
            ui_set_visible(Roll_InAir, false)
            ui_set_visible(Roll_Fakeduck, true)
        end
    end
end)

client.set_event_callback('shutdown', function() 
    ui.set_visible(AA_roll, true)
end)




--fakeflick

local curtime = globals.curtime()

fakeFlick = false

client.set_event_callback("setup_command", function(cmd)
    fakeFlick = not fakeFlick
    if ui.get(fake_flick) then
    ui.set(fl_limit, 1)
    else
    ui.set(fl_limit, 15)
    end
    ui.set(byaw_val, (ui.get(fake_flick_invert) and -180 or 180))
    ui.set(byaw, "Static")
    if globals.curtime() > curtime + 0.1 and ui.get(fake_flick) then
        ui.set(yaw_val, (ui.get(fake_flick_invert) == 1 and -100 or 100))
        curtime = globals.curtime()
    else
        ui.set(yaw_val, 0)
    end
end)







--on_run_command
local function run_command()
	if ui.get(exploit_choice) == "Default" then
		ui.set_visible(yawbody, false)
	    ui.set_visible(yaw, false)
	    ui.set_visible(bodyyaw, false)
	    ui.set_visible(bodyyaw2, false)
	    ui.set_visible(edge, false)
	    ui.set_visible(jyaw, false)
	    ui.set_visible(jyawslide, false)
	    ui.set_visible(pitch, false)
	    ui.set_visible(yawbase, false)
	    ui.set_visible(freestanding, false)
	    ui.set_visible(freestanding2, false)
	    ui.set_visible(fyawlimit, false)
	    ui.set_visible(freestand_byaw, false)
        ui.set_visible(fake_flick, false)
        ui.set_visible(fake_flick_invert, false)   
        ui.set_visible(sex, false)


        
    elseif ui.get(exploit_choice) == "Roll aa" then
		ui.set_visible(yawbody, false)
	    ui.set_visible(yaw, false)
	    ui.set_visible(bodyyaw, false)
	    ui.set_visible(bodyyaw2, false)
	    ui.set_visible(edge, false)
	    ui.set_visible(jyaw, false)
	    ui.set_visible(jyawslide, false)
	    ui.set_visible(pitch, false)
	    ui.set_visible(yawbase, false)
	    ui.set_visible(freestanding, false)
	    ui.set_visible(freestanding2, false)
	    ui.set_visible(fyawlimit, false)
	    ui.set_visible(freestand_byaw, false)
        ui.set_visible(fake_flick, false)
        ui.set_visible(fake_flick_invert, false) 
        ui.set_visible(sex, true)
       


    elseif ui.get(exploit_choice) == "Fake flick" then
		ui.set_visible(yawbody, false)
	    ui.set_visible(yaw, false)
	    ui.set_visible(bodyyaw, false)
	    ui.set_visible(bodyyaw2, false)
	    ui.set_visible(edge, false)
	    ui.set_visible(jyaw, false)
	    ui.set_visible(jyawslide, false)
	    ui.set_visible(pitch, false)
	    ui.set_visible(yawbase, false)
	    ui.set_visible(freestanding, false)
	    ui.set_visible(freestanding2, false)
	    ui.set_visible(fyawlimit, false)
	    ui.set_visible(freestand_byaw, false)
        ui.set_visible(fake_flick, true)
        ui.set_visible(fake_flick_invert, true)
        ui.set_visible(sex, false)
    end
    

    
    
end



    


--callbacks
client.set_event_callback("run_command", run_command)
